
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Examen Psicom√©trico</title>
  <meta name="robots" content="noindex">

  <style>
   
  :root{
    --bg:#f5f7f5;
    --card:#ffffff;
    --ink:#222;
    --ink-2:#555;
    --line:#e9ece9;
    --brand:#2e7d32;
    --brand-2:#4caf50;
  }

  html,body{background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink)}
  *{box-sizing:border-box}

  .container{max-width:860px;margin:auto;background:var(--card);padding:24px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.04)}
  h1{font-size:28px;margin:0 0 10px}
  h2{margin:0 0 8px}
  p{color:var(--ink-2)}

  /* Progreso */
  .progress-bar{height:10px;background:#e7efe7;border-radius:999px;margin:6px 0 14px;overflow:hidden}
  .progress-fill{height:100%;width:0;background:var(--brand-2);transition:width .3s}

  /* Navegaci√≥n */
  .nav-buttons{display:flex;justify-content:space-between;margin:16px auto 0;max-width:860px}
  .nav-buttons.hidden{display:none!important}
  .hidden{display:none!important}

  /* Bot√≥n primario */
  button{background:var(--brand-2);color:#fff;border:none;border-radius:10px;padding:12px 18px;font-weight:600;cursor:pointer;transition:transform .04s ease,opacity .2s}
  button:hover{transform:translateY(-1px)}
  button:disabled{opacity:.55;cursor:not-allowed}

  /* CTA inicial (oportunidades) */
  .btn-start{display:inline-flex;align-items:center;gap:10px;width:100%;font-size:18px;background:var(--brand-2)}
  .badge-open{background:#e8f5e9;color:var(--brand);border:1px solid #d5edd7;border-radius:999px;padding:2px 8px;font-size:12px;font-weight:700}
  .dot{width:8px;height:8px;border-radius:50%;background:var(--brand);box-shadow:0 0 0 0 rgba(46,125,50,.6);animation:pulse 1.6s infinite}
  @keyframes pulse{to{box-shadow:0 0 0 10px rgba(46,125,50,0)}}

  /* Tarjeta resultado */
  .ve-result-card{max-width:760px;margin:16px auto;text-align:left;border:1px solid var(--line);border-radius:12px;padding:18px 20px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .ve-kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:8px 16px;margin-top:10px}
  .ve-kpi{background:#f8fbf8;border:1px solid #e7f3e7;border-radius:10px;padding:10px 12px}
  .ve-badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#e8f5e9;color:var(--brand);font-weight:700;font-size:12px}
  .ve-subtle{color:#666;font-size:12px}
  .ve-meter{width:100%;height:10px;background:#eee;border-radius:6px;overflow:hidden;margin-top:6px}
  .ve-meter-fill{height:100%;width:0;background:var(--brand-2);transition:width .5s ease;border-radius:6px}

  /* Enviar (estado enviando) */
  #btnEnviar{position:relative}
  #btnEnviar.sending{background:#9e9e9e}
  .ve-spinner{width:18px;height:18px;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;display:inline-block;vertical-align:-3px;animation:ve-spin .7s linear infinite;margin-right:8px}
  #btnEnviar .ve-spinner{display:none}
  #btnEnviar.sending .ve-spinner{display:inline-block}
  @keyframes ve-spin{to{transform:rotate(360deg)}}

  @media (prefers-reduced-motion: reduce){
  .dot { animation: none; }
  .progress-fill, .ve-meter-fill { transition: none; }
  }



  </style>


</head>
<body>

  <div id="oportunidades" style="max-width:700px;margin:40px auto;font-family:Arial,sans-serif;">
    <h2 style="text-align:center;color:#333;">OPORTUNIDADES ABIERTAS</h2>

  <!-- Bot√≥n para mostrar la oferta -->

  <button onclick="toggleJob()" class="btn-start" aria-expanded="false" aria-controls="jobDetails">
    <span class="dot" aria-hidden="true"></span>
   üëâ Asistente de Bienestar - 100% Remoto
    <span class="badge-open">Abierta</span>
  </button>


  <!-- Contenedor oculto que se despliega -->
  <div id="jobDetails" style="display:none;margin-top:20px;border:1px solid #ccc;
        border-radius:8px;padding:20px;">

    <h3 style="margin-top:0;color:#444;">Descripci√≥n del puesto</h3>
    <p>
    En <strong>VitalExtension</strong>, buscamos a una persona con <strong>calidez, empat√≠a y vocaci√≥n de servicio</strong> para acompa√±ar a
    nuestros usuarios en su experiencia de salud personalizada. Si te mueve el prop√≥sito y te ilusiona
    trabajar donde <em>ciencia, innovaci√≥n y humanidad</em> se encuentran, este rol es para ti.
  </p>

  <h4>Lo que har√°s</h4>
  <ul>
    <li>Ser el <strong>primer contacto humano</strong> de la cl√≠nica, transmitiendo cercan√≠a y confianza.</li>
    <li><strong>Acompa√±ar</strong> al paciente en su recorrido por la cl√≠nica y la plataforma digital.</li>
    <li>Apoyar la <strong>gesti√≥n de agendas m√©dicas</strong> y la telemedicina (<strong>VitalCare</strong>).</li>
    <li>Favorecer una experiencia <strong>humana, emp√°tica y de confianza</strong> en cada interacci√≥n.</li>
    <li>Resolver dudas con el uso de la plataforma, productos y servicios.</li>
    <li>Recoger <strong>feedback</strong> clave para mejorar continuamente la experiencia del paciente.</li>
    <li>Proponer ideas que sorprendan y cuiden mejor a nuestra comunidad.</li>
  </ul>

  <h4>Lo que ofrecemos</h4>
  <ul>
    <li>Trabajo <strong>100&nbsp;% remoto</strong>.</li>
    <li><strong>Horario flexible</strong> para equilibrar vida y trabajo.</li>
    <li><strong>Formaci√≥n gratuita</strong> en longevidad, biomarcadores y salud de precisi√≥n.</li>
    <li>Cultura sin estr√©s, con <strong>bienestar real</strong> y trabajo significativo.</li>
    <li>Proyecto con <strong>prop√≥sito</strong>: ayudar a otros mientras t√∫ tambi√©n creces.</li>
  </ul>

  <p>
    Si has sido pre-seleccionado/a en Indeed o InfoJobs, por favor confirma tu estado para continuar:
  </p>

    <!-- Casilla de confirmaci√≥n -->
    <label style="display:block;margin:15px 0;">
      <input type="checkbox" id="confirmBox" onchange="toggleNextBtn()"> 
      Confirmo que he sido pre-seleccionado/a para este puesto de empleo
    </label>

    <!-- Bot√≥n siguiente -->
    <button id="nextBtn" disabled onclick="empezarCuestionario()" style="padding:12px 20px;font-size:16px;
        background-color:#bbb;color:#fff;border:none;border-radius:6px;cursor:not-allowed;">
      Siguiente
    </button>
  </div>
</div>

<script>
  function toggleJob() {
  const job = document.getElementById('jobDetails');
  const isOpen = job.style.display === "block";
  job.style.display = isOpen ? "none" : "block";
  const btn = document.querySelector('.btn-start');
  if (btn) btn.setAttribute('aria-expanded', String(!isOpen));
}


  function toggleNextBtn() {
    const check = document.getElementById('confirmBox').checked;
    const btn = document.getElementById('nextBtn');
    if(check){
      btn.disabled = false;
      btn.style.backgroundColor = "#4caf50";
      btn.style.cursor = "pointer";
    } else {
      btn.disabled = true;
      btn.style.backgroundColor = "#bbb";
      btn.style.cursor = "not-allowed";
    }
  }
  function empezarCuestionario() {
  // Oculta oportunidades
  document.getElementById('oportunidades')?.classList.add('hidden');

  // Muestra cuestionario y navegaci√≥n
  document.querySelector('.container')?.classList.remove('hidden');
  document.querySelector('.nav-buttons')?.classList.remove('hidden');

  // Sit√∫a el test en el primer bloque y sincroniza progreso
  currentBlock = 0;
  showBlock(currentBlock);
  actualizarProgreso();

  // Lleva al usuario al inicio del contenedor
  window.scrollTo({ top: 0, behavior: 'smooth' });
}



</script>



<div class="container hidden">
  <h1>Cuestionario de Estilo de Asistencia</h1>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
<p id="progressText" style="text-align:right; font-weight:bold;"></p>

  <form id="quizForm">
  <div class='question-block' id='block0' style='display: none;'>
<h2>Bienvenido/a al Examen de Selecci√≥n para el puesto de Asistente de Bienestar</h2>
<div class='question'>
  <p><strong>Este cuestionario no mide teor√≠a, sino tu forma de acompa√±ar a personas reales.</strong></p>
  <p>Encontrar√°s escenarios pr√°cticos alineados con la misi√≥n de VitalExtension: acercar la medicina de precisi√≥n y la longevidad a todas las personas, de forma humana, accesible y cient√≠fica.</p>
  <p>No hay respuestas ‚Äúcorrectas‚Äù: cada opci√≥n refleja un estilo distinto. Elige la que m√°s resuene contigo, sin darle demasiadas vueltas.</p>
  <p>Hazlo en un entorno tranquilo. Solo puede completarse una vez. Al final ver√°s un resumen de tu estilo y c√≥mo encaja con nuestro enfoque.</p>
  <p>‚è±Ô∏è Duraci√≥n aproximada: 6 minutos.</p>
</div>
</div>
<div class='question-block' id='block1' style='display: none;'>
<h2>Edad biol√≥gica</h2>
<div class='question'><p><strong>Un usuario pregunta: ‚Äú¬øQu√© gano conociendo mi edad biol√≥gica si ya s√© mi edad cronol√≥gica?". ¬øC√≥mo act√∫as?</strong></p>
<label><input type='radio' name='block1_q0' value='1' data-question-id='block1_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Explicarle que la edad biol√≥gica mide el estado real de sus c√©lulas y es un mejor predictor de longevidad.</label><br><br>
<label><input type='radio' name='block1_q0' value='1' data-question-id='block1_q0'  data-weight='1' data-pilar='Emocional-Social' onchange='actualizarProgreso()'> Mostrarle ejemplos de c√≥mo otros clientes cambiaron h√°bitos tras conocer su edad biol√≥gica.</label><br><br>
<label><input type='radio' name='block1_q0' value='1' data-question-id='block1_q0'  data-weight='1' data-pilar='Ingenier√≠a' onchange='actualizarProgreso()'> Recordarle que lo que no se mide no se mejora, y que este n√∫mero es la br√∫jula de su plan personalizado.</label><br><br>
<label><input type='radio' name='block1_q0' value='0' data-question-id='block1_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Decirle que es un dato curioso, pero que no aporta nada relevante.</label><br><br>
</div>
</div>
<div class='question-block' id='block2' style='display: none;'>
<h2>Expectativas milagrosas</h2>
<div class='question'><p><strong>Un usuario insiste en que quiere resultados inmediatos de un programa digital de salud, aunque sabes que estos dependen de constancia y tiempo. ¬øC√≥mo respondes?</strong></p>
<label><input type='radio' name='block2_q0' value='1' data-question-id='block2_q0'  data-weight='1' data-pilar='Emp√°tico' onchange='actualizarProgreso()'> Escuchas su expectativa, validas su motivaci√≥n y explicas que los cambios sostenibles requieren un proceso progresivo.</label><br><br>
<label><input type='radio' name='block2_q0' value='1' data-question-id='block2_q0'  data-weight='1' data-pilar='Anal√≠tico' onchange='actualizarProgreso()'> Le cuentas que cada persona es diferente, y que lo importante es el seguimiento continuo y la personalizaci√≥n.</label><br><br>
<label><input type='radio' name='block2_q0' value='1' data-question-id='block2_q0'  data-weight='1' data-pilar='Pragm√°tico' onchange='actualizarProgreso()'> Le propones fijar metas a corto plazo medibles, para que vea progreso realista mientras trabaja en el objetivo final.</label><br><br>
<label><input type='radio' name='block2_q0' value='0' data-question-id='block2_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le prometes que conseguir√° el resultado inmediato que busca</label><br>
</div>
</div>
<div class='question-block' id='block3' style='display: none;'>
<h2>Paciente mayor y digital</h2>
<div class='question'><p><strong>Un paciente mayor no entiende c√≥mo usar la plataforma digital de VitalExtension. ¬øC√≥mo reaccionas?</strong></p>
<label><input type='radio' name='block3_q0' value='1' data-question-id='block3_q0'  data-weight='1' data-pilar='Emp√°tico' onchange='actualizarProgreso()'> Hacer una videollamada y guiarlo paso a paso hasta que se sienta seguro.</label><br><br>
<label><input type='radio' name='block3_q0' value='1' data-question-id='block3_q0'  data-weight='1' data-pilar='Pedag√≥gico' onchange='actualizarProgreso()'> Enviarle un tutorial visual, con im√°genes grandes y lenguaje sencillo.</label><br><br>
<label><input type='radio' name='block3_q0' value='0' data-question-id='block3_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Mandarle un manual gen√©rico sin personalizaci√≥n y desentenderte.</label><br><br>
<label><input type='radio' name='block3_q0' value='1' data-question-id='block3_q0'  data-weight='1' data-pilar='Emocional' onchange='actualizarProgreso()'> Reafirmarle que no est√° solo; aunque seamos digitales, siempre tendr√° apoyo humano cercano.</label><br>
</div>
</div>
<div class='question-block' id='block4' style='display: none;'>
<h2>Biomarcadores</h2>
<div class='question'><p><strong>Un paciente pregunta por qu√© tiene que hacerse nuevos an√°lisis de biomarcadores cuando cree que basta con la anal√≠tica b√°sica que se hizo el a√±o pasado. ¬øC√≥mo lo explicas?</strong></p>
<label><input type='radio' name='block4_q0' value='1' data-question-id='block4_q0'  data-weight='1' data-pilar='Emp√°tico' onchange='actualizarProgreso()'> Le reconoces la duda y le explicas que es normal pensar que una anal√≠tica b√°sica es suficiente, pero que los biomarcadores permiten ver cambios invisibles mucho antes.</label><br><br>
<label><input type='radio' name='block4_q0' value='1' data-question-id='block4_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Le explicas que una anal√≠tica b√°sica solo muestra par√°metros generales, mientras que los biomarcadores avanzados permiten medir edad biol√≥gica, inflamaci√≥n cr√≥nica y riesgo silencioso de enfermedades antes de que den s√≠ntomas.</label><br><br>
<label><input type='radio' name='block4_q0' value='1' data-question-id='block4_q0'  data-weight='1' data-pilar='Pragm√°tico' onchange='actualizarProgreso()'> Le pones un ejemplo claro: igual que no revisamos el coche una sola vez en su vida, la salud necesita chequeos peri√≥dicos con indicadores m√°s profundos.</label><br><br>
<label><input type='radio' name='block4_q0' value='0' data-question-id='block4_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le dices que probablemente con la anal√≠tica del a√±o pasado es m√°s que suficiente.</label><br>
</div>
</div>
<div class='question-block' id='block5' style='display: none;'>
<h2>Estr√©s</h2>
<div class='question'><p><strong>Un usuario dice: ‚ÄúEstoy demasiado estresado para hacer cambios‚Äù.</strong></p>
<label><input type='radio' name='block5_q0' value='1' data-question-id='block5_q0'  data-weight='1' data-pilar='Emocional' onchange='actualizarProgreso()'> Recordarle que la longevidad empieza por cuidar la mente y reducir el estr√©s.</label><br><br>
<label><input type='radio' name='block5_q0' value='1' data-question-id='block5_q0'  data-weight='1' data-pilar='Pr√°ctico' onchange='actualizarProgreso()'> Ofrecerle microacciones sencillas que pueda empezar sin sentirse abrumado.</label><br><br>
<label><input type='radio' name='block5_q0' value='1' data-question-id='block5_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Mostrarle estudios que prueban que reducir estr√©s mejora marcadores de envejecimiento.</label><br><br>
<label><input type='radio' name='block5_q0' value='0' data-question-id='block5_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Decirle que debe esforzarse igual aunque est√© estresado.</label><br>
</div>
</div>
<div class='question-block' id='block8' style='display: none;'>
<h2>Datos y Privacidad</h2>
<div class='question'><p><strong>Un usuario de una plataforma digital te pregunta si sus datos personales estar√°n protegidos. ¬øQu√© har√≠as?</strong></p>
<label><input type='radio' name='block8_q0' value='1' data-question-id='block8_q0'  data-weight='1' data-pilar='Experto' onchange='actualizarProgreso()'> Le explicas con calma las medidas de seguridad y protocolos de privacidad que se aplican.</label><br><br>
<label><input type='radio' name='block8_q0' value='1' data-question-id='block8_q0'  data-weight='1' data-pilar='Emp√°tico' onchange='actualizarProgreso()'> Le transmites que la confianza es esencial, y que puede solicitar informaci√≥n m√°s detallada si lo desea.</label><br><br>
<label><input type='radio' name='block8_q0' value='1' data-question-id='block8_q0'  data-weight='1' data-pilar='Educador' onchange='actualizarProgreso()'> Le compartes ejemplos de buenas pr√°cticas en gesti√≥n segura de datos en servicios digitales.</label><br><br>
<label><input type='radio' name='block8_q0' value='0' data-question-id='block8_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le dices que no se preocupe, que los detalles t√©cnicos no importan, lo importante es confiar.</label><br>
</div>
</div>
<div class='question-block' id='block9' style='display: none;'>
<h2>Resoluci√≥n de conflicto</h2>
<div class='question'><p><strong>Un paciente ten√≠a cita con su m√©dico habitual, pero este ha tenido que cancelarla a √∫ltima hora por un contratiempo. El paciente est√° muy molesto y quiere atenci√≥n pronto. ¬øC√≥mo lo acompa√±ar√≠as para resolver la situaci√≥n?</strong></p>
<label><input type='radio' name='block9_q0' value='1' data-question-id='block9_q0'  data-weight='1' data-pilar='Pragm√°tico' onchange='actualizarProgreso()'> Le reconocer√≠a su malestar y le explicar√≠a que a trav√©s de VitalCare puede elegir otro m√©dico disponible incluso hoy mismo, para que no tenga que esperar.</label><br><br>
<label><input type='radio' name='block9_q0' value='1' data-question-id='block9_q0'  data-weight='1' data-pilar='Emp√°tico' onchange='actualizarProgreso()'> Intentar√≠a tranquilizarlo, destacando que aunque el contratiempo no era previsible, gracias a VitalCare puede intentar conseguir atenci√≥n inmediata sin tener que reprogramar para otra semana.</label><br><br>
<label><input type='radio' name='block9_q0' value='1' data-question-id='block9_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Lo acompa√±ar√≠a paso a paso en la plataforma para que vea lo f√°cil que es elegir otro profesional disponible, reforzando la confianza en la flexibilidad del servicio.</label><br><br>
<label><input type='radio' name='block9_q0' value='0' data-question-id='block9_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le dir√≠a que lo mejor es esperar a que su m√©dico habitual tenga disponibilidad, ya que cambiar de profesional podr√≠a ser inc√≥modo.</label><br>
</div>
</div>
<div class='question-block' id='block10' style='display: none;'>
<h2>Rigor Cient√≠fico</h2>
<div class='question'><p><strong>Un usuario esc√©ptico pregunta: "¬øDe verdad usan ciencia seria?"</strong></p>
<label><input type='radio' name='block10_q0' value='0' data-question-id='block10_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Responder que seguimos solo blogs populares.</label><br><br>
<label><input type='radio' name='block10_q0' value='1' data-question-id='block10_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Explicarle que nos basamos en estudios en humanos publicados en revistas Q1 como Nature o The Lancet.</label><br><br>
<label><input type='radio' name='block10_q0' value='1' data-question-id='block10_q0'  data-weight='1' data-pilar='√âtico' onchange='actualizarProgreso()'> Contarle que nuestro comit√© de validaci√≥n revisa cada recomendaci√≥n</label><br><br>
<label><input type='radio' name='block10_q0' value='1' data-question-id='block10_q0'  data-weight='1' data-pilar='Emocional-Pr√°ctico' onchange='actualizarProgreso()'> Mostrarle que traducimos ciencia compleja en consejos aplicables d√≠a a d√≠a.</label><br>
</div>
</div>
<div class='question-block' id='block11' style='display: none;'>
<h2>Comunidad</h2>
<div class='question'><p><strong>Un cliente se siente solo en su proceso de cambio</strong></p>
<label><input type='radio' name='block11_q0' value='0' data-question-id='block11_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Decirle que debe ser fuerte por s√≠ mismo</label><br><br>
<label><input type='radio' name='block11_q0' value='1' data-question-id='block11_q0'  data-weight='1' data-pilar='Emocional' onchange='actualizarProgreso()'> Recordarle que VitalExtension es tambi√©n una comunidad que lo acompa√±a</label><br><br>
<label><input type='radio' name='block11_q0' value='1' data-question-id='block11_q0'  data-weight='1' data-pilar='Social' onchange='actualizarProgreso()'> Conectarlo con grupos de usuarios que comparten experiencias.</label><br><br>
<label><input type='radio' name='block11_q0' value='1' data-question-id='block11_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Mostrarle evidencia de que la adherencia mejora al estar acompa√±ado.</label><br>
</div>
</div>
<div class='question-block' id='block12' style='display: none;'>
<h2>Inteligencia Artificial en Medicina</h2>
<div class='question'><p><strong>Un cliente dice: "Me da miedo que usen inteligencia artificial en mi salud"</strong></p>
<label><input type='radio' name='block12_q0' value='0' data-question-id='block12_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Decirle que la IA sustituye a los m√©dicos.</label><br><br>
<label><input type='radio' name='block12_q0' value='1' data-question-id='block12_q0'  data-weight='1' data-pilar='√âtico' onchange='actualizarProgreso()'> Explicarle que la IA en VitalExtension es un copiloto que apoya al m√©dico, nunca lo sustituye.</label><br><br>
<label><input type='radio' name='block12_q0' value='1' data-question-id='block12_q0'  data-weight='1' data-pilar='Cient√≠fico' onchange='actualizarProgreso()'> Contarle que la IA permite analizar grandes vol√∫menes de biomarcadores para personalizar al m√°ximo.</label><br><br>
<label><input type='radio' name='block12_q0' value='1' data-question-id='block12_q0'  data-weight='1' data-pilar='Emocional' onchange='actualizarProgreso()'> Recordarle que la IA est√° para hacer su vida m√°s f√°cil y darle m√°s confianza en sus decisiones.</label><br>
</div>
</div>
<div class='question-block' id='block13' style='display: none;'>
<h2>Romper moldes</h2>
<div class='question'><p><strong>Un amigo del cliente le dice: ‚ÄúEso de la longevidad es solo para ricos‚Äù. ¬øQu√© deber√≠a responder?</strong></p>
<label><input type='radio' name='block13_q0' value='0' data-question-id='block13_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> S√≠, es un lujo exclusivo</label><br><br>
<label><input type='radio' name='block13_q0' value='1' data-question-id='block13_q0'  data-weight='1' data-pilar='Prop√≥sito' onchange='actualizarProgreso()'> No, VitalExtension quiere que todos tengamos acceso a ciencia avanzada, sin importar el bolsillo</label><br><br>
<label><input type='radio' name='block13_q0' value='1' data-question-id='block13_q0'  data-weight='1' data-pilar='Racional-Econ√≥mico' onchange='actualizarProgreso()'> Ellos eliminan gastos innecesarios para que la ciencia sea accesible</label><br><br>
<label><input type='radio' name='block13_q0' value='1' data-question-id='block13_q0'  data-weight='1' data-pilar='Emocional' onchange='actualizarProgreso()'> Me hace sentir que estoy en una comunidad que cuida de m√≠ como persona, no como cliente VIP</label><br>
</div>
</div>
<div class='question-block' id='block14' style='display: none;'>
<h2>Comparaci√≥n competencia</h2>
<div class='question'><p><strong>Un usuario de una plataforma digital te expresa dudas porque piensa que, al tener un precio m√°s bajo que otras opciones similares, la calidad podr√≠a ser inferior. ¬øC√≥mo respondes?</strong></p>
<label><input type='radio' name='block14_q0' value='1' data-question-id='block14_q0'  data-weight='1' data-pilar='Mediador' onchange='actualizarProgreso()'> Escuchar primero, empatizar con su temor y luego explicarle c√≥mo el modelo digital permite reducir costes sin sacrificar calidad.</label><br><br>
<label><input type='radio' name='block14_q0' value='1' data-question-id='block14_q0'  data-weight='1' data-pilar='Directo' onchange='actualizarProgreso()'> Le explicas directamente que el precio no siempre refleja la calidad, y que en este caso el modelo digital elimina costes innecesarios.</label><br><br>
<label><input type='radio' name='block14_q0' value='1' data-question-id='block14_q0'  data-weight='1' data-pilar='Pragm√°tico' onchange='actualizarProgreso()'> Le propones que valore la experiencia tras usar el servicio antes de juzgarlo.</label><br><br>
<label><input type='radio' name='block14_q0' value='0' data-question-id='block14_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le respondes que los precios bajos siempre implican menor calidad.</label><br>
</div>
</div>
<div class='question-block' id='block15' style='display: none;'>
<h2>Inversi√≥n en salud</h2>
<div class='question'><p><strong>Durante una sesi√≥n, un cliente da pistas que gasta mucho dinero en ocio y cosas materiales, pero duda si merece la pena invertir en pruebas de biomarcadores o servicios de longevidad. Quiere tu opini√≥n sobre si realmente vale la pena destinar recursos a su salud futura.</strong></p>
<label><input type='radio' name='block15_q0' value='1' data-question-id='block15_q0'  data-weight='1' data-pilar='Racional' onchange='actualizarProgreso()'> Le explicas que invertir en su salud hoy es la mejor manera de evitar gastos m√©dicos mayores en el futuro: es una estrategia inteligente y preventiva.</label><br><br>
<label><input type='radio' name='block15_q0' value='1' data-question-id='block15_q0'  data-weight='1' data-pilar='Emocional' onchange='actualizarProgreso()'> Le dices que priorizar su bienestar es una forma de demostrar amor propio y responsabilidad hacia sus seres queridos.</label><br><br>
<label><input type='radio' name='block15_q0' value='1' data-question-id='block15_q0'  data-weight='1' data-pilar='Prop√≥sito' onchange='actualizarProgreso()'> Le cuentas que los servicios de VitalExtension son como una br√∫jula: una inversi√≥n que le permite tomar decisiones informadas y ganar a√±os de vitalidad.</label><br><br>
<label><input type='radio' name='block15_q0' value='0' data-question-id='block15_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le respondes que la salud no necesita inversi√≥n, que basta con esperar a que aparezcan problemas.</label><br>
</div>
</div>
<div class='question-block' id='block16' style='display: none;'>
<h2>Relaci√≥n con redes sociales</h2>
<div class='question'><p><strong>Durante la primera sesi√≥n con un cliente, √©l comenta que suele pasar bastante tiempo en redes sociales, pero no sabe si eso puede jugar a favor o en contra de su salud. Te pregunta c√≥mo deber√≠a usarlas de forma que aporten valor en su proceso de longevidad.</strong></p>
<label><input type='radio' name='block16_q0' value='1' data-question-id='block16_q0'  data-weight='1' data-pilar='Social' onchange='actualizarProgreso()'> Le explicas que puede usarlas para inspirarse con contenido de salud de calidad y luego compartirlo con sus familiares y amigos m√°s cercanos.</label><br><br>
<label><input type='radio' name='block16_q0' value='0' data-question-id='block16_q0'  data-weight='1' data-pilar='Distractor' onchange='actualizarProgreso()'> Le dices que las redes son solo para ocio y que no deber√≠an usarse para temas de salud.</label><br><br>
<label><input type='radio' name='block16_q0' value='1' data-question-id='block16_q0'  data-weight='1' data-pilar='Racional-Cient√≠fico' onchange='actualizarProgreso()'> Le aconsejas que siga cuentas cient√≠ficas y m√©dicas de confianza para mantenerse actualizado, pero siempre contrastando con evidencia real.</label><br><br>
<label><input type='radio' name='block16_q0' value='1' data-question-id='block16_q0'  data-weight='1' data-pilar='Prop√≥sito' onchange='actualizarProgreso()'> Le dices que las redes son un buen lugar para conectar con comunidades de bienestar y encontrar apoyo en otras personas que persiguen objetivos similares.</label><br>
</div>
</div>
<div class='question-block' id='block17' style='display: none;'>
<h2>Percepci√≥n aspiracional</h2>
<div class='question'><p><strong>Un usuario joven te dice que quiere rodearse de personas que piensen en grande sobre salud y longevidad, porque siente que en su entorno no encuentra esa motivaci√≥n.</strong></p>
<label><input type='radio' name='block17_q0' value='1' data-question-id='block17_q0'  data-weight='1' data-pilar='Social' onchange='actualizarProgreso()'> Le explicas que formar parte de VitalExtension le conecta con una comunidad de personas que aspiran a vivir m√°s y mejor.</label><br><br>
<label><input type='radio' name='block17_q0' value='1' data-question-id='block17_q0'  data-weight='1' data-pilar='Motivador-Visionario' onchange='actualizarProgreso()'> Le animas a que siga proyectos innovadores de longevidad que lo inspiren a proyectar su mejor versi√≥n.</label><br><br>
<label><input type='radio' name='block17_q0' value='0' data-question-id='block17_q0'  data-weight='0' data-pilar='Distractor' onchange='actualizarProgreso()'> Le dices que debe conformarse con lo que hay y que no es necesario buscar un entorno motivador.</label><br><br>
<label><input type='radio' name='block17_q0' value='1' data-question-id='block17_q0'  data-weight='1' data-pilar='Prop√≥sito' onchange='actualizarProgreso()'> Le cuentas que rodearse de personas con prop√≥sito refuerza la identidad y multiplica los resultados de cualquier esfuerzo personal.</label><br>
</div>
</div>
<div class='question-block' id='block18' style='display: none;'>
  <h2>Tu inter√©s personal en la salud</h2>
  <div class='question'>
    <p><strong>
      Para acompa√±ar a otros en su camino, primero debemos recorrer el nuestro. Esta experiencia personal es la que convierte cada conversaci√≥n con nuestros usuarios en un consejo aut√©ntico y cercano.  
      ¬øCu√°nto inter√©s genuino sientes en mejorar tu propia salud y en probar los protocolos y servicios de VitalExtension?
    </strong></p>
    
    <label><input type='radio' name='block18_q0' value='1' data-question-id='block18_q0' data-noalign='true' data-pilar='Distractor' onchange='actualizarProgreso()'> 1 ‚Äì Nada interesado/a</label><br><br>
    <label><input type='radio' name='block18_q0' value='2' data-question-id='block18_q0' data-noalign='true' data-pilar='Distractor' onchange='actualizarProgreso()'> 2 ‚Äì Poco interesado/a</label><br><br>
    <label><input type='radio' name='block18_q0' value='3' data-question-id='block18_q0' data-noalign='true' data-pilar='Emocional' onchange='actualizarProgreso()'> 3 ‚Äì Moderadamente interesado/a</label><br><br>
    <label><input type='radio' name='block18_q0' value='4' data-question-id='block18_q0' data-noalign='true' data-pilar='Prop√≥sito' onchange='actualizarProgreso()'> 4 ‚Äì Muy interesado/a</label><br><br>
    <label><input type='radio' name='block18_q0' value='5' data-question-id='block18_q0' data-noalign='true' data-pilar='Prop√≥sito' onchange='actualizarProgreso()'> 5 ‚Äì Completamente interesado/a</label><br>
  </div>
</div>
  </div>

  </form>
  <div class="nav-buttons hidden">
    <button type="button" onclick="prevBlock()">Anterior</button>
    <button type="button" onclick="nextBlock()">Siguiente</button>
  </div>

  
<div id="emailScreen" class="hidden" style="text-align:center; margin-top: 30px;">
    <h2>Para terminar </h2>
    <p>Ind√≠canos el email con el que te inscribiste la oferta de empleo. <br>Tu resultado se mostrar√° en el siguiente paso.</p>
    
    
    <!-- Formulario para que el usuario ponga su nombre y su email -->
    <input
      id="userName"
      placeholder="Tu nombre"
      type="text"
      style="padding:10px;width:70%;max-width:300px;margin-bottom:10px;">
    <br>
    <input
      id="userEmail"
      type="email"
      placeholder="tu@email.com"
      autocomplete="email"
      autocapitalize="off"
      autocorrect="off"
      spellcheck="false"
      inputmode="email"
      style="padding:10px;width:70%;max-width:300px;">
    <br><br>


  <!-- Pais de residencia -->
  <label for="pais">Pa√≠s de residencia:</label><br>
  <select id="pais" name="pais" required>
    <option value="">Seleccione su pa√≠s...</option>
    <option value="Argentina">Argentina</option>
    <option value="Chile">Chile</option>
    <option value="Colombia">Colombia</option> 
    <option value="EEUU">EEUU</option>
    <option value="Espa√±a">Espa√±a</option>
    <option value="M√©xico">M√©xico</option>
    <option value="Panam√°">Panam√°</option>
    <option value="Uruguay">Uruguay</option> 
    <option value="Otro">Otro</option>
  </select><br><br>

  <!-- CAPTCHA -->
    <div style="margin-top: 12px;">
      <label id="captchaPregunta" style="font-size: 14px;">Cargando pregunta de seguridad...</label><br/>
      <input id="captchaRespuesta" type="tel" inputmode="numeric" pattern="[0-9]*" style="margin-top:4px;width:60px;" />

    </div>

  <!-- Honeypot -->
    <div style="position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;" aria-hidden="true">
      <label for="campoTrampa">No completar</label>
      <input id="campoTrampa" type="text" tabindex="-1" autocomplete="new-password" />
    </div>

  <!-- Checkbox RGPD -->
    <div style="margin-top: 12px; font-size: 14px;">
      <label for="consentimientoRGPD">
        <input id="consentimientoRGPD" type="checkbox" />
        Acepto la <a href="https://nrventurini.github.io/Pol-tica_privacidad/" target="_blank" rel="noopener noreferrer">pol√≠tica de privacidad</a>.
      </label>
    <p style="font-size: 13px; color: #555; margin-top: 8px;">
    <span style="font-size: 15px;">‚öñÔ∏è <strong>Compromiso VitalExtension</strong>:</span>
    Jam√°s cederemos tu email ni enviaremos spam. Solo lo usaremos para continuar con el proceso de Selecci√≥n.
    </p>
      </div>

  <!-- Mensaje previo al env√≠o -->
  
  <p id="preSendInfo" role="note" style="margin:10px 0 6px; font-size:12.5px; color:#555;">
    Al pulsar <strong>ENVIAR</strong> registraremos tus datos y ver√°s tu informe al instante.
    <strong>No cierres esta ventana</strong>.
  </p>


    <button id="btnEnviar" aria-describedby="preSendInfo" type="button" onclick="validarEmail()" aria-live="polite">
      <span class="ve-spinner" aria-hidden="true"></span>
      <span class="ve-btn-text">Enviar mi Examen</span>
    </button>

 <div id="sendStatus" aria-live="polite" style="margin-top:8px; font-size:13px; color:#555;"></div>  <!-- Contenedor para el mensaje visual de "Por favor, espera unos segundos" cuando el usuario le da al bot√≥n "Enviar mi Examen" RGPD -->

</div>
  <div id="result" class="hidden">
  </div>

<script>
// =====================
//  LOGIC JS
// =====================

// --- ESTADO GLOBAL ---
// Captcha global que comparten nextBlock() y validarEmail()
let captchaActual = { pregunta: '', respuesta: '' };

// HACEMOS GLOBAL EL BANCO DE PREGUNTAS CAPTCHA
const preguntasCaptcha = [
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 3 + 5?", respuesta: "8" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 6 - 2?", respuesta: "4" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 1 + 2?", respuesta: "3" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 3 + 2?", respuesta: "5" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 5 + 2?", respuesta: "7" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 7 + 2?", respuesta: "9" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 2 x 1?", respuesta: "2" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 3 - 2?", respuesta: "1" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 3 + 3?", respuesta: "6" },
  { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 10 - 5?", respuesta: "5" }
];



// Esta secci√≥n gestiona la navegaci√≥n por bloques, la validaci√≥n de respuestas,
  const bloqueIds = ['block0', 'block1', 'block2', 'block3', 'block4', 'block5','block8', 'block9', 'block10', 'block11', 'block12', 'block13','block14','block15','block16','block17','block18'];

  // √çndice del bloque actual que se est√° mostrando
let currentBlock = 0;

let __finished = false;

  
// Mostrar solo el bloque (pantalla) correspondiente al √≠ndice actual.
// Tambi√©n se llama a actualizarProgreso() para mantener la barra de progreso sincronizada.
function showBlock(index) {

    bloqueIds.forEach((id, i) => {
      const el = document.getElementById(id);
    if (el) el.style.display = i === index ? 'block' : 'none';
    });

  }

  
// Funci√≥n que se ejecuta al pulsar "Siguiente".
// Valida que todas las preguntas del bloque actual est√©n respondidas.

function nextBlock() {
  if (__finished) return;
  const block = document.getElementById(bloqueIds[currentBlock]);
  // Validaci√≥n por grupo (name)
  const radios = block.querySelectorAll('input[type="radio"]');
  const names = [...new Set([...radios].map(r => r.name))];
  for (const name of names) {
    if (!block.querySelector(`input[name="${name}"]:checked`)) {
      alert('Por favor, responde todas las preguntas antes de continuar.');
      return;
    }
  }
  const numbers = block.querySelectorAll('input[type="number"]');
  for (const num of numbers) {
    if (!num.value) { alert('Por favor, completa todos los campos num√©ricos.'); return; }
  }
  if (currentBlock < bloqueIds.length - 1) {
    currentBlock++;
    showBlock(currentBlock);
    actualizarProgreso();
  } else {
    try { calcularResultados(); }
    catch (err) { console.error("calcularResultados() fall√≥:", err);
      alert("Ocurri√≥ un problema al generar tu resultado. Refresca la p√°gina e int√©ntalo nuevamente."); }
  }
}

  
// Funci√≥n que se ejecuta al pulsar "Anterior" para retroceder al bloque anterior.
function prevBlock() {
  if (__finished) return; // ‚¨ÖÔ∏è bloquea navegaci√≥n tras finalizar el test (aunque ya los ocultamos, esto evita estados extra√±os si alguien triggera eventos v√≠a teclado)
    if (currentBlock > 0) {
      currentBlock--;
      showBlock(currentBlock);
    actualizarProgreso();
    }
  }

  

// Esta funci√≥n actualiza la barra de progreso basada en preguntas individuales respondidas.
// Cuenta los elementos √∫nicos por su data-question-id y calcula el % completado.
function actualizarProgreso() {
  const preguntas = document.querySelectorAll('[data-question-id]');
  const totalUnico = new Set([...preguntas].map(p => p.dataset.questionId)).size;

  const respondidas = new Set();
  preguntas.forEach(el => {
    if (el.type === 'radio') {
      const name = el.name;
      if (document.querySelector(`input[name='${name}']:checked`)) {
        respondidas.add(el.dataset.questionId);
      }
    } else if (el.type === 'number' && el.value) {
      respondidas.add(el.dataset.questionId);
    }
  });

  const completado = Math.round((respondidas.size / totalUnico) * 100);
  const fill = document.getElementById("progressFill");
  const text = document.getElementById("progressText");
  fill.style.width = completado + "%";
  text.textContent = completado + "% completado";
}


function setSendingState(isSending) {
  const btn = document.getElementById('btnEnviar');
  if (!btn) return;
  const textEl = btn.querySelector('.ve-btn-text');
  const statusEl = document.getElementById('sendStatus');

  if (isSending) {
    // guardar texto original y activar estilo
    if (!btn.dataset.originalText) btn.dataset.originalText = textEl.textContent;
    textEl.textContent = "ENVIANDO‚Ä¶";
    btn.disabled = true;
    btn.classList.add("sending");
    btn.setAttribute("aria-busy", "true");
    if (statusEl) statusEl.textContent = "Por favor, espera unos segundos mientras registramos tus datos‚Ä¶";
  } else {
    // restaurar
    textEl.textContent = btn.dataset.originalText || "Enviar mi Examen";
    btn.disabled = false;
    btn.classList.remove("sending");
    btn.removeAttribute("aria-busy");
    if (statusEl) statusEl.textContent = "";
  }
}

// Helper de fallo r√°pido
function failAndUnlock(msg){
  if (msg) alert(msg);
  setSendingState(false);
  return false;
}


// Validar email, RGPD, CAPTCHA, HONEYPOT, GOOGLESHEET antes de mostrar resultados finales
async function validarEmail() {
 

 // --- Guard & lock inmediato --- aunque el usuario haga ‚Äúdoble-click en el bot√≥n de "Enviar mi Examen", la segunda llamada sale por el return porque el bot√≥n ya est√° bloqueado.
  const btn = document.getElementById('btnEnviar');
  if (btn.disabled || btn.classList.contains('sending')) return;  // evita reentradas
  setSendingState(true);      // üîí bloqueo y cambia a "ENVIANDO‚Ä¶" al instante 
  
// Lee campos
  const pais = document.getElementById("pais").value;
  const name = document.getElementById("userName").value.trim();
  const email = document.getElementById("userEmail").value.trim();
  const captcha = document.getElementById("captchaRespuesta").value.trim();
  const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  
    // ‚úÖ Validar honeypot
  if (document.getElementById("campoTrampa").value !== "") return failAndUnlock("Detecci√≥n de comportamiento autom√°tico.");

  // 2) CAPTCHA (r√°pido) + regeneraci√≥n si falla
    ensureCaptcha();
    if (!captchaActual || captcha !== String(captchaActual.respuesta).trim()) {
      regenerateCaptcha(true); // 
      return failAndUnlock("Respuesta incorrecta a la pregunta de seguridad. Intenta de nuevo.");
    }

    //3) ‚úÖ Validar RGPD
  if (!document.getElementById("consentimientoRGPD").checked) return failAndUnlock("Debes aceptar la pol√≠tica de privacidad para continuar.");

    //4) ‚úÖ Validar que el pa√≠s est√° seleccionado
    if (!pais) return failAndUnlock("Por favor, selecciona tu pa√≠s de residencia.");

  // ‚úÖ Validar que el formato del email est√° correcto
  if (!regex.test(email)) return failAndUnlock("Por favor, introduce un email v√°lido.");

  // ‚úÖ  Revisar que el email no haya hecho ya el examen de Selecci√≥n
  const ya = await emailExisteEnSheet(email);
  if (ya) return failAndUnlock("Este email ya ha realizado este Examen de Selecci√≥n, y est√° en proceso de revisi√≥n. Muchas Gracias.");

 
  // Evitar doble clic + feedback visual
    setSendingState(true);

// ===== empaquetar resultados ampliados =====
  const data = {
    Nombre: name || "",
    Email: email,
    Origen: "Examen_Seleccion_Asistente_Bienestar_20250824",
    pais: pais,


    // M√©trica de alineaci√≥n visi√≥n y arquetipos
    PuntuacionBruta: typeof window.__score === 'number' ? window.__score : 0,             // n¬∫ respuestas alineadas
    TotalPreguntas: contarTotalPreguntas(true),
    PctAlineacion: typeof window.__pctAlineacion === 'number' ? window.__pctAlineacion : 0,

    // M√©trica de motivaci√≥n para adherirse a mejorar salud
    InteresPersonalPct: typeof window.__interesPersonalPct === 'number' ? window.__interesPersonalPct : '',


    // Arquetipos
    ArquetipoTop: window.__arquetipoTop || "",
    ArquetipoSec1: window.__arquetipoSec1 || "",
    ArquetipoSec2: window.__arquetipoSec2 || "",
    PctTop: typeof window.__pctTop === "number" ? window.__pctTop : 0,
    PctSec1: typeof window.__pctSec1 === "number" ? window.__pctSec1 : 0,
    PctSec2: typeof window.__pctSec2 === "number" ? window.__pctSec2 : 0,

    //Buckets (conteo por arquetipo)
    BucketsJSON: JSON.stringify(window.__buckets || {}),

    // Respuestas completas y clave (para futuros an√°lisis de conversi√≥n/retenci√≥n)
    AllAnswersJSON: JSON.stringify(window.__allAnswers || []),
    KeyAnswersJSON: JSON.stringify(window.__keyAnswers || []),

    // Metadatos
    DeviceTimeISO: new Date().toISOString(),
    VersionTest: "v1.0" // √∫til si cambias pesos o copy en el tiempo
  };



  // ‚úÖ Enviar a Google Sheets. 
  enviarResultadosAGoogleSheets(data)
      .then(() => {

        // ocultar pantalla de email
        document.getElementById("emailScreen").classList.add("hidden");

        // construir e inyectar el HTML del resultado
        const resDiv = document.getElementById("result");
        resDiv.innerHTML = construirFeedbackHTML(
          window.__pctAlineacion,
          window.__buckets,
          window.__arquetipoTop,
          window.__arquetipoSec1,
          window.__arquetipoSec2,
          window.__pctTop,
          window.__pctSec1,
          window.__pctSec2
        );

        // ocultar la barra de progreso al mostrar resultados
        document.querySelector('.progress-bar')?.classList.add('hidden');

        // Ocultar botones de navegaci√≥n (est√° duplicado por seguridad aqu√≠) para que nunca reaparezca si se renderiza algo as√≠ncrono
        __finished = true;
        document.querySelector('.nav-buttons')?.classList.add('hidden');


        // Mostrar el resultado
        resDiv.classList.remove("hidden");
      })
      
      .catch(err => {
        console.error("Fallo al enviar informaci√≥n:", err);
        const statusEl = document.getElementById('sendStatus');
        const msg = String(err && err.message || err);

        // Mensajes amables seg√∫n el error
        if (/HTTP_429|QUOTA|OVERLOAD|Rate|L√≠mite|Demasiadas/i.test(msg)) {
          if (statusEl) {
            statusEl.textContent = "üìà El servidor est√° muy concurrido ahora mismo. No perder√°s nada. Por favor, espera unos segundos y pulsa de nuevo ‚ÄúEnviar mi Examen‚Äù.";
          }
        } else {
          if (statusEl) {
            statusEl.textContent = "‚ö†Ô∏è Hemos tenido un problema registrando tus datos. No se han perdido. Reintenta en unos segundos.";
          }
        }

        // Rehabilita el bot√≥n para reintentar
        setSendingState(false);
      });

    
}

async function emailExisteEnSheet(email) {
  const url = "https://script.google.com/macros/s/AKfycbxeaeLrwEtgDJVtqJSk6w1i8T17yTmqp3t_j3_kM4oc1CYGsZMUroQH60suF_qj8to/exec"
            + "?action=check&email=" + encodeURIComponent(email);
  try {
    const res = await fetch(url, { method: "GET", cache: "no-store" });
    if (!res.ok) return false;
    const data = await res.json().catch(() => null);
    return !!(data && data.ok && data.exists);
  } catch (e) {
    console.warn("Fallo check email (no bloqueo):", e);
    return false; // degradaci√≥n amable: no bloquea al usuario
  }
}

async function postWithRetry(url, options, tries = 2){
  let lastErr;
  for (let i = 0; i <= tries; i++){
    try {
      const res = await fetch(url, { keepalive: true, ...options });
      const txt = await res.text();
      let json;
      try { json = JSON.parse(txt); } catch { json = { ok:false, error:'JSON_PARSE' }; }
      if (!res.ok || !json.ok) {
        const msg = json.error || ('HTTP_' + res.status);
        throw new Error(msg);
      }
      return json;
    } catch(e){
      lastErr = e;
      await new Promise(r => setTimeout(r, 800 * (i + 1))); // backoff un poco mayor
    }
  }
  throw lastErr;
}



function enviarResultadosAGoogleSheets(data) {
  const formData = new FormData();
  formData.append('dedupe', 'true'); // soporte servidor
  for (const key in data) formData.append(key, data[key] == null ? '' : data[key]);

  // usa el helper con reintento
  return postWithRetry("https://script.google.com/macros/s/AKfycbxeaeLrwEtgDJVtqJSk6w1i8T17yTmqp3t_j3_kM4oc1CYGsZMUroQH60suF_qj8to/exec", {
    method: "POST",
    body: formData
  }, 2);
}


// ======== 1) NORMALIZACI√ìN DE PILARES Y TEXTOS ========
const PILAR_MAP = {
  // Emp√°tico‚ÄìComunidad
  "Emp√°tico":"Emp√°tico","Emocional":"Emp√°tico","Social":"Emp√°tico","Emocional-Social":"Emp√°tico",
  // Cient√≠fico‚ÄìAnal√≠tico
  "Cient√≠fico":"Cient√≠fico","Anal√≠tico":"Cient√≠fico","Experto":"Cient√≠fico","Educador":"Cient√≠fico",
  "Racional-Cient√≠fico":"Cient√≠fico","Ingenier√≠a":"Cient√≠fico","√âtico":"Cient√≠fico", "Racional-Econ√≥mico":"Cient√≠fico",
  // Pragm√°tico‚ÄìOperativo
  "Pragm√°tico":"Pragm√°tico","Pr√°ctico":"Pragm√°tico","Emocional-Pr√°ctico":"Pragm√°tico",
  "Pedag√≥gico":"Pragm√°tico","Mediador":"Pragm√°tico","Directo":"Pragm√°tico",
  // Prop√≥sito‚ÄìVisi√≥n
  "Prop√≥sito":"Prop√≥sito","Cultural-Inspirador":"Prop√≥sito","Motivador-Visionario":"Prop√≥sito",
  // Distractor
  "Distractor":"Distractor"
};

const PILAR_PRETTY = {
  "Emp√°tico":"Emp√°tico‚ÄìComunidad",
  "Cient√≠fico":"Cient√≠fico‚ÄìAnal√≠tico",
  "Pragm√°tico":"Pragm√°tico‚ÄìOperativo",
  "Prop√≥sito":"Prop√≥sito‚ÄìVisi√≥n"
};

const FEEDBACK_TXT = {
  "Emp√°tico": {
    titulo: "Perfil Emp√°tico‚ÄìComunidad",
    cuerpo: "Priorizas la escucha y el acompa√±amiento humano. Creas confianza y sostienes la adherencia con cercan√≠a.",
    fortalezas: "Trato humano, motivaci√≥n, adherencia.",
    potenciar: "Protocolos claros y herramientas digitales sencillas."
  },
  "Cient√≠fico": {
    titulo: "Perfil Cient√≠fico‚ÄìAnal√≠tico",
    cuerpo: "Buscas evidencia y claridad. Traduces informaci√≥n compleja en decisiones informadas.",
    fortalezas: "Credibilidad, rigor, educaci√≥n del paciente.",
    potenciar: "Materiales basados en estudios en humanos y gu√≠as de comunicaci√≥n clara."
  },
  "Pragm√°tico": {
    titulo: "Perfil Pragm√°tico‚ÄìOperativo",
    cuerpo: "Te orientas a soluciones paso a paso, con foco en resultados medibles.",
    fortalezas: "Resoluci√≥n de problemas, micro-h√°bitos, eficiencia.",
    potenciar: "Checklists, metas SMART y seguimiento con m√©tricas simples."
  },
  "Prop√≥sito": {
    titulo: "Perfil Prop√≥sito‚ÄìVisi√≥n",
    cuerpo: "Te mueve el impacto y el sentido. Inspiras conectando salud con prop√≥sito y comunidad.",
    fortalezas: "Inspiraci√≥n, liderazgo informal, activaci√≥n de comunidad.",
    potenciar: "Espacios de comunidad y proyectos con misi√≥n clara."
  }
};

// Preguntas clave a trazar
const KEY_QUESTIONS = [
  "block2_q0",   // Expectativas (realismo/adhesi√≥n)
  "block8_q0",   // Datos & privacidad (confianza/√©tica)
  "block14_q0",  // Precio vs valor (objeciones)
  "block15_q0",  // Inversi√≥n en salud (micro-compromiso)
  "block16_q0"   // Redes sociales (comunidad/CTA)
];


// ======== 2) RESULTADO COMPUESTO: % ALINEACI√ìN + ARQUETIPO. Calcula y guarda, pero NO los muestra========

function calcularResultados() {

  // 1) Recoger respuestas marcadas
  const seleccionadas = Array.from(document.querySelectorAll("input[type='radio']:checked"));

  // 2) % de alineaci√≥n con la visi√≥n (value=1)
  const alineadas = seleccionadas.filter(r => r.dataset.noalign !== 'true' && parseInt(r.value,10) === 1).length; //‚¨ÖÔ∏è Aqu√≠ tengo en cuenta que se ignore la pregunta que tiene como noalign === True
  const totalPreguntas = contarTotalPreguntas(true); // Excluir noalign del denominador
  const pctAlineacion = Math.round((alineadas / totalPreguntas) * 100);

  // 3) Conteo por arquetipo normalizado (solo en respuestas alineadas)
  const buckets = { Emp√°tico:0, Cient√≠fico:0, Pragm√°tico:0, Prop√≥sito:0, Distractor:0 };
  seleccionadas.forEach(r => {
    if (r.dataset.noalign === 'true') return; // ‚¨ÖÔ∏è Lo utilizo para ignorar del conteo las pregutnas que tienen el noalign ===true
    const raw = r.dataset.pilar || "";
    const norm = PILAR_MAP[raw] || "Pragm√°tico";
    if (parseInt(r.value,10) === 1) {
      buckets[norm] = (buckets[norm] || 0) + 1;
    } else {
      buckets["Distractor"]++;
    }
  });

  // 4) Determinar top y secundarios (desempate: Emp√°tico > Pragm√°tico > Cient√≠fico > Prop√≥sito)
  const ordenPreferencia = ["Emp√°tico","Pragm√°tico","Cient√≠fico","Prop√≥sito"];
  const ranking = Object.entries(buckets)
    .filter(([k]) => k !== "Distractor")
    .sort((a,b) => b[1]-a[1] || ordenPreferencia.indexOf(a[0]) - ordenPreferencia.indexOf(b[0]));

  const top = ranking[0]?.[0] || "Emp√°tico";
  const sec1 = ranking[1]?.[0] || null;
  const sec2 = ranking[2]?.[0] || null;

  // 5) % normalizados por arquetipo (solo sobre respuestas alineadas)
  const totalAlineadas = ranking.reduce((acc, [,v]) => acc + v, 0);
  const pctBy = (k) => totalAlineadas > 0 ? Math.round((buckets[k] / totalAlineadas) * 100) : 0;

  const pctTop = pctBy(top);
  const pctSec1 = sec1 ? pctBy(sec1) : 0;
  const pctSec2 = sec2 ? pctBy(sec2) : 0;


// Motivaci√≥n personal en adherirse a h√°bitos saludables (block18)
let interesPersonal = null;
let interesPersonalPct = null;
const selInteres = document.querySelector("input[name='block18_q0']:checked");
if (selInteres) {
  interesPersonal = parseInt(selInteres.value,10);           // 1..5
  interesPersonalPct = Math.round(((interesPersonal - 1) / 4) * 100); // 0..100
}


  // 6) Guardar en memoria global para usar tras enviar el email
  window.__score = alineadas;
  window.__pctAlineacion = pctAlineacion;
  window.__buckets = buckets;
  window.__arquetipoTop = top;
  window.__arquetipoSec1 = sec1;
  window.__arquetipoSec2 = sec2;
  window.__pctTop = pctTop;
  window.__pctSec1 = pctSec1;
  window.__pctSec2 = pctSec2;
  window.__interesPersonalPct = interesPersonalPct;

  // Trazabilidad: respuestas completas y clave
  const { allAnswers, keyAnswers } = recolectarRespuestasSeleccionadas(seleccionadas);
  window.__allAnswers = allAnswers;
  window.__keyAnswers = keyAnswers;

  // 7) Al terminar el cuestionario: esconder test y mostrar SOLO pantalla de email
  document.getElementById('quizForm').classList.add('hidden');

  const nav = document.querySelector('.nav-buttons');
  if (nav) nav.classList.add('hidden');   // ‚Üê oculta Siguiente/Atr√°s al entrar al email
 
  document.getElementById('emailScreen').classList.remove('hidden');

  __finished = true;



  // 8) Generar/actualizar
  captchaActual = preguntasCaptcha[Math.floor(Math.random() * preguntasCaptcha.length)];
  document.getElementById("captchaPregunta").textContent = captchaActual.pregunta;
}

function ensureCaptcha(){
  if (captchaActual && captchaActual.pregunta) return;
  captchaActual = preguntasCaptcha[Math.floor(Math.random()*preguntasCaptcha.length)];
  const lbl = document.getElementById('captchaPregunta');
  if (lbl) lbl.textContent = captchaActual.pregunta;
}

//Recargar el captcha autom√°ticamente si el usuario se equivoca al hacer la operaci√≥n de seguridad
function regenerateCaptcha(clearInput = false){
  captchaActual = preguntasCaptcha[Math.floor(Math.random() * preguntasCaptcha.length)];
  const lbl = document.getElementById("captchaPregunta");
  if (lbl) lbl.textContent = captchaActual.pregunta;
  if (clearInput){
    const input = document.getElementById("captchaRespuesta");
    if (input) input.value = "";
  }
}


// helpers
function contarTotalPreguntas(excluirNoAlign = false){
  const radios = Array.from(document.querySelectorAll("input[type='radio'][data-question-id]"));
  const ids = new Set();
  for (const r of radios){
    if (excluirNoAlign && r.dataset.noalign === 'true') continue;
    ids.add(r.dataset.questionId);
  }
  return ids.size;
}


function construirFeedbackHTML(pct, buckets, top, sec1, sec2, pctTop=0, pctSec1=0, pctSec2=0) {
  const f = FEEDBACK_TXT[top];
  const prettyTop = PILAR_PRETTY[top] || top;
  const secTxt = [sec1, sec2].filter(Boolean).map(x => PILAR_PRETTY[x]||x);

  return `
  <div style="text-align:center; margin-top: 22px;">
    <h2 style="margin-bottom:6px;">‚ú® Resultado de tu Examen</h2>
    <p style="max-width:700px;margin:0 auto 12px;color:#444;">
      Este ejercicio forma parte de nuestro proceso de selecci√≥n basado en escenarios reales.
      Algunas opciones no estaban alineadas con nuestros valores; otras nos ayudan a perfilar tu
      <strong>estilo de acompa√±amiento</strong>.
    </p>

    <div class="ve-kpis">
      <div class="ve-kpi">
        <div class="ve-badge">Alineaci√≥n con la visi√≥n</div>
        <div style="font-size:22px;font-weight:700;margin-top:6px;">${pct}%</div>
        <div class="ve-subtle">Suma de respuestas alineadas con nuestros principios</div>
      </div>

      <div class="ve-kpi">
        <div class="ve-badge">Arquetipo dominante</div>
        <div style="font-size:18px;font-weight:700;margin-top:6px;">
          ${prettyTop} <span class="ve-subtle">(${pctTop}%)</span>
        </div>
        ${
          secTxt.length
          ? `<div class="ve-subtle" style="margin-top:4px;">
               Secundarios: ${secTxt[0]} (${pctSec1}%)${secTxt[1] ? ` ¬∑ ${secTxt[1]} (${pctSec2}%)` : ``}
             </div>`
          : ``
        }
      </div>

      ${
        (typeof window.__interesPersonalPct === 'number')
        ? `
        <div class="ve-kpi">
          <div class="ve-badge">Inter√©s personal en salud</div>
          <div style="margin-top:6px;">
            <strong>${window.__interesPersonalPct}%</strong>
            <div class="ve-meter" aria-label="Nivel de inter√©s personal" style="margin-top:6px;">
              <div class="ve-meter-fill" style="width:${window.__interesPersonalPct}%"></div>
            </div>
            <div class="ve-subtle" style="margin-top:6px;">
              Autoevaluaci√≥n para entender tu motivaci√≥n de adherencia.
            </div>
          </div>
        </div>`
        : ``
      }
    </div>

    <div class="ve-result-card">
      <h3 style="margin-top:0;">${f.titulo}</h3>
      <p>${f.cuerpo}</p>
      <p><strong>Fortalezas en el rol:</strong> ${f.fortalezas}</p>
      <p><strong>C√≥mo potenciarte:</strong> ${f.potenciar}</p>
      <p class="ve-subtle" style="margin-top:8px;">
        Resultado orientativo y no cl√≠nico. Nos ayuda a entender tu forma de acompa√±ar a las personas.
      </p>
    </div>


    <div style="max-width:760px;margin:14px auto 0;padding:12px 14px;border:1px solid #e7f3e7;border-radius:10px;background:#f8fbf8;color:#2e7d32;">
    ‚úÖ <strong>Hemos recibido tus resultados correctamente.</strong> Nuestro equipo los revisar√° en detalle y, si encajas con el equipo, rol y cultura te contactaremos por email para coordinar una videollamada.
     </div>

    <div style="max-width:760px;margin:18px auto 0;text-align:center;">
      <p style="font-size:16px;color:#444;margin-bottom:10px;">
        Mientras esperas, <strong>√∫nete a la comunidad</strong> donde compartimos casos reales, gu√≠as pr√°cticas y oportunidades.
      </p>
      <div style="display:inline-flex;gap:16px;align-items:center;filter:grayscale(1);">
        <a href="https://www.instagram.com/vitalextension" target="_blank" rel="noopener" aria-label="Instagram VitalExtension" title="Instagram">
          <!-- SVG Instagram (monocromo) -->
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" role="img" aria-hidden="true">
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
          </svg>
        </a>
        <a href="https://www.facebook.com/profile.php?id=61578791393799" target="_blank" rel="noopener" aria-label="Facebook VitalExtension" title="Facebook">
          <!-- SVG Facebook (monocromo) -->
          <svg width="36" height="36" viewBox="0 0 24 24" fill="#111" role="img" aria-hidden="true">
            <path d="M22 12.06C22 6.5 17.52 2 12 2S2 6.5 2 12.06c0 5.02 3.66 9.18 8.44 9.94v-7.03H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.23.2 2.23.2v2.47h-1.26c-1.24 0-1.62.77-1.62 1.55v1.86h2.77l-.44 2.91h-2.33V22c4.78-.76 8.44-4.92 8.44-9.94z"/>
          </svg>
        </a>
      </div>
    </div>


  </div>`;
}


function recolectarRespuestasSeleccionadas(seleccionadas){
  // allAnswers: listado completo de {qid, value, pilarRaw, pilar, texto}
  const allAnswers = seleccionadas.map(r => {
    const label = r.closest("label");
    const texto = label ? label.textContent.trim() : "";
    const raw = r.dataset.pilar || "";
    const pilar = PILAR_MAP[raw] || raw;
    return {
      qid: r.dataset.questionId,
      value: parseInt(r.value,10) || 0,
      pilarRaw: raw,
      pilar,
      texto
    };
  });

  // keyAnswers: solo preguntas clave (para correlacionar m√°s tarde)
  const keyAnswers = allAnswers.filter(a => KEY_QUESTIONS.includes(a.qid));

  return { allAnswers, keyAnswers };
}

document.addEventListener('DOMContentLoaded', () => {
  showBlock(currentBlock);     // muestra el primer bloque
  actualizarProgreso();        // sincroniza la barra
});

const __DEV = false; // ponemos true s√≥lo en pruebas locales

if (__DEV) {
  window.addEventListener("error", ev => {
    alert("‚ö†Ô∏è Error en el script: " + (ev.message || "desconocido") + "\nRevisa la consola (F12).");
  });
  window.addEventListener('unhandledrejection', ev => {
    alert("‚ö†Ô∏è Error en el proceso: " + (ev.reason?.message || ev.reason || "desconocido"));
    setSendingState(false);
  });
} else {
  window.addEventListener("error", () => {/* noop en producci√≥n */});
  window.addEventListener('unhandledrejection', () => { setSendingState(false); });
}




</script>
</body>
</html>
